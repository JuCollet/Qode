"use strict";var jumpnext=function(e){switch(e){case 1:document.decode.char2.focus();break;case 2:document.decode.char3.focus();break;case 3:document.decode.char4.focus();break;case 4:document.decode.char5.focus()}};angular.module("app",["ui.router","ngResource"]),angular.module("mobile",["ionic","ui.router","ngResource","app"]).config(["$stateProvider","$urlRouterProvider",function(e,o){e.state("app",{url:"/app",abstract:!0,templateUrl:"templates/menu.html",controller:""}).state("app.search",{url:"/search",views:{menuContent:{templateUrl:"templates/search.html"}}}).state("app.favorites",{url:"/favorites",views:{menuContent:{templateUrl:"templates/favorites.html"}}}).state("app.login",{url:"/login",views:{menuContent:{templateUrl:"templates/login.html"}}}).state("app.myqodes",{url:"/myqodes",views:{menuContent:{templateUrl:"templates/myqodes.html"}}}).state("app.qodeview",{url:"/qodeview",views:{menuContent:{templateUrl:"templates/qodeview.html"}}}).state("app.register",{url:"/register",views:{menuContent:{templateUrl:"templates/register.html"}}}),o.otherwise("/app/search")}]),angular.module("mobile").controller("MobileController",["$scope","$rootScope","userFactory",function(e,o,t){o.isLogged={log:!1,name:""},t.user.isLogged().$promise.then(function(e){void 0!==e.isLogged&&!0===e.isLogged.log?(o.isLogged.log=!0,o.isLogged.name=e.isLogged.name):(o.isLogged.log=!1,o.isLogged.name="")},function(e){if(e)throw e})}]),angular.module("app").factory("qodeFactory",["$resource","$q",function(e,o){var t=e("/api/qodes/check/",null,{check:{method:"POST"}}),n=function(e,o,n){t.check({qode:e}).$promise.then(function(e){e.isAvailable?o():n()},function(e){return e})},a=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],i=[],r="";return{mockQodes:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3;return o(function(o,t){i=[];for(var s=0;s<e;s++){r="";for(var c=0;c<5;c++)r+=c<2?a[Math.floor(24*Math.random())]:Math.floor(10*Math.random());i.push(r)}n(i[e-1],function(){o(i)},function(){t("error")})})},checkQodeIfAvailable:n}}]),angular.module("app").service("viewQodeFactory",["$resource",function(e){return{qodes:e("/api/qodes/:id",null,{upvote:{url:"/api/qodes/upvote/",method:"POST"}})}}]),angular.module("app").factory("newQodeFactory",["$rootScope","$resource","$http",function(e,o,t){var n=o("/api/qodes/:id",null,{create:{method:"POST"},save:{method:"PUT"},edit:{url:"/api/qodes/edit/",method:"POST"}}),a={activate:function(){$("#ulButton").removeClass("is-light").addClass("button-yellow"),$("#ulButton span").text("Add file"),$("#ulButton i").removeClass("fa-spinner fa-spin").addClass("fa-plus"),$("#ulButton input").attr("disabled",!1)},disable:function(){$("#ulButton").addClass("is-light").removeClass("button-yellow"),$("#ulButton span").text("Uploading..."),$("#ulButton i").removeClass("fa-plus").addClass("fa-spinner fa-spin"),$("#ulButton input").attr("disabled",!0)}},i=function(o,n,i,r){t({method:"PUT",url:n,data:o}).then(function(e){var t=void 0;o.name.length>20&&(t=o.name.split(""),t.splice(20,t.length-20),t.push("..."),t=t.join(""));var n=e.config.url.split("?")[0];r(t||o.name,n,o.type.split("/")[1].toUpperCase()),a.activate()},function(){e.$broadcast("notification",{color:"red",title:"Oops...",message:"Try again later",glyph:"fa fa-times"}),a.activate()})};return{dbOperations:n,getSignedRequest:function(o,n){t({method:"GET",url:"/sign-s3?file-name="+o.name+"&file-type="+o.type}).then(function(e){i(o,e.data.signedRequest,e.data.url,n)},function(){e.$broadcast("notification",{color:"red",title:"Oops...",message:"Try again later",glyph:"fa fa-times"}),a.activate()})},uploadButtonStateChange:a}}]),angular.module("app").factory("userFactory",["$resource",function(e){return{user:e("/user",null,{addToFavorites:{url:"/user/addtofavorites",method:"PUT"},deleteQode:{url:"/user/deleteqode/:qodeId",method:"DELETE"},isLogged:{url:"/user/islogged",method:"GET"},login:{url:"/user/login",method:"POST"},logout:{url:"/user/logout",method:"GET"},recovery:{url:"/user/passwordrecovery",method:"POST"},register:{method:"POST"},reset:{method:"PUT"},removeFromFavorites:{url:"/user/removefromfavorites",method:"PUT"}})}}]),angular.module("app").controller("AppController",["$scope","$rootScope","$timeout","userFactory",function(e,o,t,n){var a=$("notification");e.notificationColor="",e.notificationMessageTitle="",e.notificationMessage="",e.notificationGlyph="",e.backButtonDestination="root.encode",$(function(){$('[data-toggle="tooltip"]').tooltip()}),o.isLogged={log:!1,name:""},n.user.isLogged().$promise.then(function(e){void 0!==e.isLogged&&!0===e.isLogged.log?(o.isLogged.log=!0,o.isLogged.name=e.isLogged.name):(o.isLogged.log=!1,o.isLogged.name="")},function(e){if(e)throw e}),o.$on("$stateChangeSuccess",function(o,t,n,a){null!==a.name&&void 0!==a.name&&("root.myaccount"===a.name?e.backButtonDestination="root.myaccount":"root.login"===a.name?e.backButtonDestination="root.login":"root.decode"===a.name?e.backButtonDestination='root.decode({encode:"decode"})':e.backButtonDestination="root.encode")}),e.$on("notification",function(o,n){e.notificationColor=n.color,e.notificationMessageTitle=n.title,e.notificationMessage=n.message,e.notificationGlyph=n.glyph,e.$applyAsync(function(){$("body > div").addClass("is-blurred"),a.fadeIn(250).delay(1500).fadeOut(500)}),t(function(){$("body > div").removeClass("is-blurred")},2250)})}]),angular.module("app").controller("NavController",["$scope","$rootScope","$state",function(e,o,t){var n=t.params.encode||"encode",a=$(".switch"),i=$(".switch-cursor");!function(){"encode"===n?i.css({marginLeft:"4px"}):i.css({marginLeft:"34px"})}();e.switchToggle=function(){"decode"===n?i.animate({marginLeft:"4px"},50,function(){t.go("root.encode",{encode:"encode"})}):$(window).width()>768?i.animate({marginLeft:"34px"},50,function(){t.go("root.decode",{encode:"decode"})}):i.animate({marginLeft:"34px"},50,function(){t.go("root.decodexs",{encode:"decode"})})},a.tooltip({show:200,hide:500})}]),angular.module("app").controller("NewQodeController",["$rootScope","$scope","$state","$timeout","newQodeFactory",function(e,o,t,n,a){var i=0,r=["default","orange","yellow","green","blue","purple"],s=function(e){this.cardTitle="",this.cardText="",this.cardReferences=[],this.color=e},c=function(e,o){this.text=e,this.link=o},d=function(e,o,t){this.fileName=e,this.filePath=o,this.fileType=t},l=function(e,t,n){o.newQode.files.push(new d(e,t,n))};o.newReference={url:"",name:""},o.removeFile=function(e){o.newQode.files.splice(e,1)},o.removeReference=function(e,t){o.newQode.cards[e].cardReferences.splice(t,1)},a.dbOperations.edit({qode:t.params.qode}).$promise.then(function(e){o.newQode=e},function(o){t.go("root.encode"),e.$broadcast("notification",{color:"red",message:o.data.error.message,title:"Oops...",glyph:"fa fa-times"})}),o.confirm=!1,o.confirmToggle=function(){o.confirm=!o.confirm},o.addNewCard=function(){i++,i===r.length&&(i=1),o.newQode.cards.push(new s(r[i]))};var u=function(o){return"http://"===o.substring(7,0)||"https://"===o.substring(8,0)||"www."===o.substring(4,0)||(e.$broadcast("notification",{color:"red",message:"No valid url found",title:"Oops...",glyph:"fa fa-times"}),!1)};o.addReference=function(t){if(u(o.newReference.url))return""!==o.newReference.url&&""!==o.newReference.name?(o.newQode.cards[t].cardReferences.push(new c(o.newReference.name,o.newReference.url)),void(o.newReference={url:"",name:""})):""!==o.newReference.url?(o.newQode.cards[t].cardReferences.push(new c(o.newReference.url,o.newReference.url)),void(o.newReference={url:"",name:""})):void e.$broadcast("notification",{color:"red",message:"No reference to add",title:"Oops...",glyph:"fa fa-times"})},o.deleteCard=function(e){$("#card"+e+">.card-delete").fadeOut(50,function(){$("#card"+e).slideUp(200,function(){o.newQode.cards.splice(parseInt(e),1),o.$apply()})})},o.postQode=function(){if(void 0===o.newQode.title||o.newQode.title.length<2)return e.$broadcast("notification",{color:"red",message:"You forgot the title",title:"Oops...",glyph:"fa fa-times"}),void o.confirmToggle();a.dbOperations.save({id:o.newQode._id},o.newQode).$promise.then(function(){e.$broadcast("notification",{color:"green",message:"Your Qode is online",title:"Congratulations !",glyph:"fa fa-check"}),n(function(){t.go("root.qode",{id:o.newQode.qode})},1500)})},document.getElementById("fileUpload").onchange=function(){if(o.newQode.files.length<5){var t=document.getElementById("fileUpload").files,n=t[0];if(null===n||void 0===n)return;a.uploadButtonStateChange.disable(),n.size<10485760?a.getSignedRequest(n,l):(e.$broadcast("notification",{color:"red",title:"Oops...",message:"This file is too big",glyph:"fa fa-tachometer"}),a.uploadButtonStateChange.activate())}else e.$broadcast("notification",{color:"red",message:"5 files maximum",title:"Sorry...",glyph:"fa fa-times"})},$(".card-color-choice").click(function(e){var o=$(this),t=$(this).parents()[1];"true"===o.attr("data-isSelected")?($(".card-color-choice").removeAttr("data-isSelected"),$(t).attr("data-color","default")):($(".card-color-choice").removeAttr("data-isSelected"),o.attr("data-isSelected",!0),$(t).attr("data-color",e.currentTarget.id.substr(11)))})}]),angular.module("app").controller("EncodeController",["$rootScope","$scope","qodeFactory","newQodeFactory","userFactory","$state",function(e,o,t,n,a,i){var r=$(".qode-code")[0].children,s=0,c=0,d=void 0,l=function e(o){setTimeout(function(){return s<o.length?c<o[0].length?($(r[s]).text(o[c][s]),c++,void e(o)):(c=0,s++,void e(o)):void(s=0)},25)};o.getThisQode=function(){t.checkQodeIfAvailable(d,function(){a.user.isLogged().$promise.then(function(o){void 0!==o.isLogged&&!0===o.isLogged.log?n.dbOperations.create({qode:d}).$promise.then(function(){i.go("root.newQode",{qode:d})}):e.$broadcast("notification",{color:"red",message:"You're not logged",title:"Oops...",glyph:"fa fa-times"})})},function(){e.$broadcast("notification",{color:"red",message:"It's not available anymore",title:"Oops...",glyph:"fa fa-times"})})},o.getQodes=function(){t.mockQodes(5).then(function(e){d=e[e.length-1],l(e)},function(){o.getQodes()})},o.getQodes()}]),angular.module("app").controller("DecodeController",["$scope","viewQodeFactory","$timeout","$state",function(e,o,t,n){var a=$(".qode-code")[0].children,i=["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"],r=0,s="",c=!1;document.onkeyup=function(e){null!==document.getElementById("qodeDecode")&&(r<2&&-1!==i.indexOf(e.key.toLowerCase())?($(a[r]).text(e.key),r<5&&(s+=e.key.toUpperCase(),r++)):r>1&&parseInt(e.key)>=0&&parseInt(e.key)<=9&&($(a[r]).text(e.key),r<=4&&(s+=e.key,r++)),"Backspace"===e.key&&(r>0&&(r--,s=s.slice(0,r)),$(a[r]).html("&nbsp;")),5===s.length&&!1===c?(c=!0,$("#status").html('<i class="fa fa-refresh fa-spin"></i>&nbsp;&nbsp;Searching...'),o.qodes.get({id:s}).$promise.then(function(){$("#status").html('<i class="fa fa-check is-green"></i>&nbsp;&nbsp;Found'),t(function(){n.go("root.qode",{id:s})},500),c=!1},function(e){$("#status").html('<i class="fa fa-times is-red"></i>&nbsp;&nbsp;'+e.statusText+" :("),c=!1})):$("#status").html("&nbsp;"))}}]),angular.module("app").controller("ViewQodeController",["$scope","$stateParams","viewQodeFactory","userFactory",function(e,o,t,n){e.data=t.qodes.get({id:o.id}).$promise.then(function(o){e.qode=o}),e.thanksAuthor=function(o){t.qodes.upvote({toUpvote:o}).$promise.then(function(){e.qode.upVotes++,e.qode.isLiked=!0})},e.addToFavorites=function(o){n.user.addToFavorites({favId:o}).$promise.then(function(){e.qode.isFavorited=!0})}}]),angular.module("app").controller("UserController",["$rootScope","$scope","$state","userFactory",function(e,o,t,n){o.name="",o.mail="",o.password="",o.confirmPassword="",o.passwordValidation=function(){return o.password===o.confirmPassword},o.login=function(){var a={mail:o.mail,password:o.password};n.user.login(a).$promise.then(function(o){e.isLogged={log:!0,name:o.name,favorites:o.favorites},t.go("root.encode",{encode:"encode"})},function(o){e.$broadcast("notification",{color:"red",message:o.data.error.message,title:"Oops...",glyph:"fa fa-times"})})},o.logout=function(){n.user.logout().$promise.then(function(){e.isLogged={log:!1,name:"",favorites:[]}},function(){e.$broadcast("notification",{color:"red",message:"Can't log out",title:"Oops...",glyph:"fa fa-times"})})},o.register=function(){var a={name:o.name,mail:o.mail,password:o.password,confirmPassword:o.confirmPassword};if(a.password!==a.confirmPassword)return void e.$broadcast("notification",{color:"red",message:"doesn't match",title:"Passwords",glyph:"fa fa-times"});n.user.register(a).$promise.then(function(o){e.isLogged={log:!0,name:o.name,favorites:o.favorites},e.$broadcast("notification",{color:"green",message:"You're in, "+o.name,title:"Welcome",glyph:"fa fa-check"}),t.go("root.encode",{encode:"encode"})},function(o){e.$broadcast("notification",{color:"red",message:o.data.error.message,title:"Oops...",glyph:"fa fa-times"})})},!0===e.isLogged.log&&(o.data=n.user.get().$promise.then(function(e){o.user=e})),o.viewQode=function(e){t.go("root.qode",{id:e})},o.removeFromFavorites=function(e,t){o.user.favorites.splice(t,1),n.user.removeFromFavorites({favId:e})},o.deleteQode=function(e,t){o.user.myqodes.splice(t,1),n.user.deleteQode({qodeId:e})},o.editQode=function(e){t.go("root.newQode",{qode:e})},o.recovery=function(){n.user.recovery({mail:o.mail}).$promise.then(function(){e.$broadcast("notification",{color:"green",message:"Check your emails.",title:"Alright !",glyph:"fa fa-check"}),t.go("root.encode")},function(o){e.$broadcast("notification",{color:"red",message:o.data.error.message,title:"Oops..",glyph:"fa fa-times"})})},o.resetPassword=function(){n.user.reset({newPassword:o.confirmPassword}).$promise.then(function(){e.$broadcast("notification",{color:"green",message:"Password reset",title:"Alright !",glyph:"fa fa-check"}),t.go("root.encode")})}}]),angular.module("app").directive("notification",function(){return{restrict:"E",templateUrl:"views/notification.html"}}).directive("confirmation",function(){return{restrict:"E",templateUrl:"views/confirmation.html"}});